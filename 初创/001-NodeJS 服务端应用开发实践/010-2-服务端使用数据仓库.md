# 服务端使用数据仓库

[toc]

## 1. 数据仓库连接

- 服务端应用需要一套方法来连接数据库服务
- Drivers 数据驱动 , 将服务端应用的需求告诉数据库并获取返回值
- mysql2 是 node 包 , 且支持 mySQL 数据服务

### 1.1. 安装数据驱动

```zsh
npm install mysql2 --save-dev
npm install types/mysql2 --save-dev
```

### 1.2. 使用数据驱动

- 需要在环境变量中先配置好相关信息

```txt
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USAER=root
MYSQL_PASSWORD=<具体的密码>
MYSQL_DATABASE=xb2_node
```

- 将`.env`中的配置导出

```js
/* 
src/app/app.config.ts
*/

import dotenv from "dotenv"

dotenv.config(); // 默认读取主目录下的.env

/**
 * 应用配置
 */
// export const {APP_PORT} = process.env;

/**
 * 数据库相关配置
*/

export const {
    MYSQL_HOST,
    MYSQL_PORT,
    MYSQL_USER,
    MYSQL_PASSWORD,
    MYSQL_DATABASE,
} = process.env;
```

- 单独创建一个处理 mysql 连接的文件

```js
/* 
src/app/databases/mysql.ts
*/
import mysql from "mysql2"
import {
    MYSQL_HOST,
    MYSQL_PORT,
    MYSQL_USER,
    MYSQL_PASSWORD,
    MYSQL_DATABASE
} from "../app.config"

/**
 * 创建并导出服务链接
*/

export const connection = mysql.createConnection({
    host:MYSQL_HOST,
    port : parseInt(MYSQL_PORT , 10),
    user:MYSQL_USER,
    password:MYSQL_PASSWORD,
    database:MYSQL_DATABASE
})
```

- 测试数据仓库的连接

```js
/* 
main.js
*/
import { connection } from "./app/database/mysql";


/** 
 * 测试数据仓库的连接
 */
connection.connect(error => {
    if (error) {
        console.log("T_T 数据库服务连接失败" , error.message);
        return;
    }
    console.log("@^_^@ 数据库服务链接成功");
})
```
